<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניהול אולם ישראל הצעיר - פתח תקווה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #fcfaf7; }
        .gold-gradient { background: linear-gradient(135deg, #D4AF37 0%, #b5952f 100%); }
        .admin-panel { display: none; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #D4AF37; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="pb-20">

    <!-- Hero Section -->
    <header class="h-[50vh] flex flex-col justify-center items-center text-white bg-slate-900 relative overflow-hidden">
        <div id="hero-img" class="absolute inset-0 opacity-40 bg-cover bg-center"></div>
        <div class="relative z-10 text-center px-4">
            <h1 class="text-5xl md:text-6xl font-extrabold mb-4">ישראל הצעיר</h1>
            <p class="text-xl text-gold opacity-90 italic">המקום המושלם לאירוע בפתח תקווה</p>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 -mt-10 relative z-20">
        
        <!-- User View: Date Selection -->
        <section class="bg-white rounded-3xl shadow-2xl p-8 border border-gray-100">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold flex items-center gap-3"><i data-lucide="calendar" class="text-gold"></i> תאריכים זמינים</h2>
                <button onclick="toggleAdminView()" class="text-gray-300 hover:text-gold transition-colors"><i data-lucide="lock" class="w-4"></i></button>
            </div>
            
            <div id="dates-list" class="grid gap-4">
                <div class="text-center py-10"><div class="loader"></div></div>
            </div>
        </section>

        <!-- Admin Dashboard (Hidden by default) -->
        <section id="admin-dashboard" class="admin-panel mt-12 bg-slate-900 text-white rounded-3xl p-8 shadow-2xl animate-bounce-in">
            <h2 class="text-3xl font-bold mb-8 text-gold border-b border-gold/20 pb-4">לוח ניהול מנהל</h2>
            
            <!-- Add New Date -->
            <div class="grid md:grid-cols-3 gap-4 mb-10 bg-white/5 p-6 rounded-2xl border border-white/10">
                <input type="text" id="new-date" placeholder="תאריך (למשל: 25.05 יום ג')" class="bg-transparent border-b border-white/30 p-2 outline-none focus:border-gold">
                <select id="new-cat" class="bg-slate-800 border-none p-2 rounded-lg">
                    <option value="אמצע שבוע">אמצע שבוע</option>
                    <option value="שבת חתן">שבת חתן</option>
                    <option value="אירוע ערב">אירוע ערב</option>
                </select>
                <button onclick="adminAction('addDate')" class="gold-gradient text-white font-bold py-2 rounded-xl">הוסף תאריך</button>
            </div>

            <!-- Manage Dates Table -->
            <div id="admin-dates-list" class="space-y-3">
                <!-- Admin date items here -->
            </div>
        </section>
    </main>

    <!-- Modal הזמנה -->
    <div id="order-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-[2rem] p-8 max-w-md w-full shadow-2xl transform transition-all">
            <h3 class="text-2xl font-bold mb-1" id="modal-date-title">שיריון אירוע</h3>
            <p class="text-gold font-bold mb-6">נא למלא פרטים והמנהל יחזור אליך</p>
            <div class="space-y-4">
                <input type="text" id="u-name" placeholder="שם מלא" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border focus:border-gold">
                <input type="tel" id="u-phone" placeholder="טלפון" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border focus:border-gold">
                <textarea id="u-notes" placeholder="סוג האירוע והערות" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border focus:border-gold h-24"></textarea>
                <button onclick="submitOrder()" id="sub-btn" class="w-full gold-gradient text-white py-4 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition-transform">שלח בקשה</button>
                <button onclick="closeModal()" class="w-full text-gray-400 text-sm">ביטול</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'הדבק_כאן_את_ה-URL_מגוגל_אפס_סקריפט';
        let adminPass = "";
        let selectedDate = "";

        // טעינת תמונות אוטומטית (ממה שבנינו קודם)
        function loadImages() {
            const formats = ['webp','jpg','png'];
            formats.forEach(ext => {
                let img = new Image();
                img.src = `01.${ext}`;
                img.onload = () => document.getElementById('hero-img').style.backgroundImage = `url('01.${ext}')`;
            });
        }

        // טעינת תאריכים
        async function fetchDates() {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            renderUserList(data.dates);
            if (adminPass) renderAdminList(data.dates);
        }

        function renderUserList(dates) {
            const list = document.getElementById('dates-list');
            list.innerHTML = dates.map(d => `
                <div onclick="${d.status === 'available' ? `openModal('${d.date}')` : ''}" 
                     class="flex justify-between items-center p-5 border-2 rounded-2xl transition-all ${d.status === 'available' ? 'border-gold/20 hover:border-gold cursor-pointer bg-white' : 'bg-gray-50 border-gray-100 opacity-50'}">
                    <div>
                        <span class="block font-bold text-xl">${d.date}</span>
                        <span class="text-sm text-gray-500">${d.category}</span>
                    </div>
                    <span class="font-bold ${d.status === 'available' ? 'text-green-600' : 'text-red-400'}">
                        ${d.status === 'available' ? 'פנוי - לחץ לשיריון' : 'תפוס'}
                    </span>
                </div>
            `).join('');
        }

        function renderAdminList(dates) {
            const list = document.getElementById('admin-dates-list');
            list.innerHTML = `<h3 class="text-gold font-bold mb-4">ניהול תאריכים קיימים:</h3>` + dates.map(d => `
                <div class="flex justify-between items-center bg-white/10 p-4 rounded-xl border border-white/5">
                    <span>${d.date} (${d.category})</span>
                    <div class="flex gap-2">
                        <button onclick="adminAction('updateStatus', {date:'${d.date}', status:'${d.status==='available'?'booked':'available'}'})" class="text-xs bg-blue-500/20 text-blue-300 px-3 py-1 rounded-lg">שנה סטטוס</button>
                        <button onclick="adminAction('deleteDate', {date:'${d.date}'})" class="text-xs bg-red-500/20 text-red-300 px-3 py-1 rounded-lg">מחק</button>
                    </div>
                </div>
            `).join('');
        }

        async function adminAction(action, extraData = {}) {
            if (!adminPass) return;
            const body = { action, password: adminPass, ...extraData };
            if (action === 'addDate') {
                body.date = document.getElementById('new-date').value;
                body.category = document.getElementById('new-cat').value;
                if (!body.date) return alert("הכנס תאריך");
            }
            
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(body) });
            fetchDates(); // רענון
        }

        function toggleAdminView() {
            const pass = prompt("סיסמת מנהל:");
            if (pass) {
                adminPass = pass;
                document.getElementById('admin-dashboard').classList.toggle('admin-panel');
                fetchDates();
            }
        }

        function openModal(date) {
            selectedDate = date;
            document.getElementById('modal-date-title').innerText = date;
            document.getElementById('order-modal').classList.remove('hidden');
        }
        function closeModal() { document.getElementById('order-modal').classList.add('hidden'); }

        async function submitOrder() {
            const name = document.getElementById('u-name').value;
            const phone = document.getElementById('u-phone').value;
            const notes = document.getElementById('u-notes').value;
            if(!name || !phone) return alert("נא למלא שם וטלפון");

            document.getElementById('sub-btn').innerText = "...שולח";
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({action:'submitOrder', name, phone, notes, date: selectedDate}) });
            alert("הבקשה נשלחה למנהל!");
            closeModal();
            fetchDates();
        }

        window.onload = () => { loadImages(); fetchDates(); lucide.createIcons(); };
    </script>
</body>
</html>
